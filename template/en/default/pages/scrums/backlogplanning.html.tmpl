[%#
  # The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Scrums Bugzilla Extension.
  #
  # The Initial Developer of the Original Code is "Nokia corporation"
  # Portions created by the Initial Developer are Copyright (C) 2011 the
  # Initial Developer. All Rights Reserved.
  #
  # Contributor(s):
  #  Eero Heino <eero.heino@nokia.com>
  #%]

[% PROCESS global/header.html.tmpl
    title = "Backlog " _ team.name
    style_urls = ['skins/standard/admin.css']
%]

[% PROCESS global/lists.html.tmpl %]

<script type="text/javascript">
  var unordered_bugs = new listObject("sortable2", "headers2", '-1', 'Unprioritized', $("#TeamBugLiTmpl"));
  var backlog = new listObject("sortable", "headers", "[% backlog.sprint.id() %]", 'Backlog', $("#TeamBugLiTmpl"));

  var all_lists = [];

  function save_all()
  {
    //$("#save").attr('disabled', 'disabled');
    function call_back()
    {
    //    $("#save").removeAttr('disabled');
    }
    save_lists([backlog], unordered_bugs, 'backlog', [% team.id %], call_back);
  }

  // data from backend
  var unordered_list_data = [[% FOREACH bug IN unprioritised_items %]
  [[% bug.0 %], [% bug.1 %], "[% bug.2 %]", "[% bug.3 %]", "[% bug.4 | replace( '"', '\"' ) %][% IF (bug.5.length > 40) %]...[% END %]", "[% bug.5 | replace( '"', '\'' ) %]"],
  [% END %]];

  var backlog_bugs = [[% FOREACH bug IN backlog.bugs %][[% bug.0 %], [% bug.1 %], "[% bug.2 %]", "[% bug.3 %]", "[% bug.4 | replace( '"', '\"' ) %][% IF (bug.5.length > 40) %]...[% END %]", "[% bug.5 | replace( '"', '\'' ) %]"],[% END %]];
  var sprint_lists = [];

  $(document).ready(function() {
    var html = '';

    $('#sprints').html(parseTemplate($('#ListTmpl').html(), { list: backlog, extra_middle: '' }));
    update_lists(backlog, 0, backlog_bugs);
    //all_lists = $.extend(true, [], sprint_lists);
    all_lists.push(backlog);

    $('#unordered').html(parseTemplate($('#ListTmpl').html(), { list: unordered_bugs, extra_middle: '' }));
    update_lists(unordered_bugs, 0, unordered_list_data);
    //all_lists = $.extend(true, [], sprint_lists);
    all_lists.push(unordered_bugs);

    bind_sortable_lists(all_lists);
  });
</script>

<div class="bz_title_container">
  [% team.name %] Product Backlog
</div>

<table>
  <tr>
    <td valign='top' id='sprints'>
    </td>
    <td valign='top' id='unordered'>
    </td>
  </tr>
  <tr>
    <td colspan="2" align="right">
      <input id='save' type='button' value='Save' OnClick='save_all();'/> 
    </td>
  </tr>
</table>

<hr />

<p>
  <a href="page.cgi?id=scrums/createteam.html&teamid=[% team.id %]">Manage Team</a>
</p>

[% PROCESS global/footer.html.tmpl %]
